<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             xmlns:model="clr-namespace:GlobalWealthPyramid"          
             xmlns:converter="clr-namespace:Syncfusion.Maui.Core.Converters;assembly=Syncfusion.Maui.Core"
             x:Class="GlobalWealthPyramid.MainPage">


    <ContentPage.BindingContext>
        <model:GlobalWealthPercentage x:Name="viewModel"/>
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <x:String x:Key="PathData">M1.38383 2.54285C1.09822 2.81296 1 3.05209 1 3.25C1 3.44791 1.09822 3.68704 1.38383 3.95715C1.67049 4.22825 2.11213 4.49542 2.69934 4.73031C3.87097 5.19896 5.52385 5.5 7.375 5.5C9.22615 5.5 10.879 5.19896 12.0507 4.73031C12.6379 4.49542 13.0795 4.22825 13.3662 3.95715C13.6518 3.68704 13.75 3.44791 13.75 3.25C13.75 3.05209 13.6518 2.81296 13.3662 2.54285C13.0795 2.27175 12.6379 2.00458 12.0507 1.76969C10.879 1.30104 9.22615 1 7.375 1C5.52385 1 3.87097 1.30104 2.69934 1.76969C2.11213 2.00458 1.67049 2.27175 1.38383 2.54285ZM13.75 4.93864C13.3818 5.21568 12.9293 5.4559 12.4221 5.65878C11.1054 6.18543 9.3208 6.5 7.375 6.5C5.4292 6.5 3.64458 6.18543 2.32795 5.65878C1.82074 5.4559 1.36822 5.21568 1 4.93864V7.375C1 7.57291 1.09822 7.81204 1.38383 8.08215C1.67049 8.35325 2.11213 8.62042 2.69934 8.85531C3.41311 9.14081 4.30549 9.36412 5.3125 9.49504V10.5029C4.18204 10.3655 3.16126 10.1171 2.32795 9.78378C1.82074 9.5809 1.36822 9.34068 1 9.06364V11.5C1 11.6979 1.09822 11.937 1.38383 12.2071C1.67049 12.4782 2.11213 12.7454 2.69934 12.9803C3.41311 13.2658 4.30549 13.4891 5.3125 13.62V14.6279C4.18204 14.4905 3.16126 14.2421 2.32795 13.9088C1.82074 13.7059 1.36822 13.4657 1 13.1886V15.625C1 15.8229 1.09822 16.062 1.38383 16.3321C1.67049 16.6032 2.11213 16.8704 2.69934 17.1053C3.41311 17.3908 4.30549 17.6141 5.3125 17.745V18.7529C4.18204 18.6155 3.16126 18.3671 2.32795 18.0338C1.67102 17.771 1.10584 17.4456 0.696718 17.0587C0.286539 16.6708 0 16.1865 0 15.625V11.5V7.375V3.25C0 2.68852 0.286539 2.20421 0.696718 1.8163C1.10584 1.42939 1.67102 1.10399 2.32795 0.841218C3.64458 0.314566 5.4292 0 7.375 0C9.3208 0 11.1054 0.314566 12.4221 0.841218C13.079 1.10399 13.6442 1.42939 14.0533 1.8163C14.4635 2.20421 14.75 2.68852 14.75 3.25V6.70583C14.5856 6.69371 14.4188 6.6875 14.25 6.6875C14.0812 6.6875 13.9144 6.69371 13.75 6.70583V4.93864ZM7.875 11.5C7.875 11.3021 7.97322 11.063 8.25883 10.7929C8.54549 10.5218 8.98713 10.2546 9.57434 10.0197C10.746 9.55104 12.3988 9.25 14.25 9.25C16.1012 9.25 17.754 9.55104 18.9257 10.0197C19.5129 10.2546 19.9545 10.5218 20.2412 10.7929C20.5268 11.063 20.625 11.3021 20.625 11.5C20.625 11.6979 20.5268 11.937 20.2412 12.2071C19.9545 12.4782 19.5129 12.7454 18.9257 12.9803C17.754 13.449 16.1012 13.75 14.25 13.75C12.3988 13.75 10.746 13.449 9.57434 12.9803C8.98713 12.7454 8.54549 12.4782 8.25883 12.2071C7.97322 11.937 7.875 11.6979 7.875 11.5ZM19.2971 13.9088C19.8043 13.7059 20.2568 13.4657 20.625 13.1886V14.9375C20.625 15.1354 20.5268 15.3745 20.2412 15.6446C19.9545 15.9157 19.5129 16.1829 18.9257 16.4178C17.754 16.8865 16.1012 17.1875 14.25 17.1875C12.3988 17.1875 10.746 16.8865 9.57434 16.4178C8.98713 16.1829 8.54549 15.9157 8.25883 15.6446C7.97322 15.3745 7.875 15.1354 7.875 14.9375V13.1886C8.24322 13.4657 8.69574 13.7059 9.20295 13.9088C10.5196 14.4354 12.3042 14.75 14.25 14.75C16.1958 14.75 17.9804 14.4354 19.2971 13.9088ZM21.625 11.5V14.9375V18.375C21.625 18.9365 21.3385 19.4208 20.9283 19.8087C20.5192 20.1956 19.954 20.521 19.2971 20.7838C17.9804 21.3104 16.1958 21.625 14.25 21.625C12.3042 21.625 10.5196 21.3104 9.20295 20.7838C8.54602 20.521 7.98084 20.1956 7.57172 19.8087C7.16154 19.4208 6.875 18.9365 6.875 18.375V14.9375V11.5C6.875 10.9385 7.16154 10.4542 7.57172 10.0663C7.98084 9.67939 8.54602 9.35399 9.20295 9.09122C10.5196 8.56457 12.3042 8.25 14.25 8.25C16.1958 8.25 17.9804 8.56457 19.2971 9.09122C19.954 9.35399 20.5192 9.67939 20.9283 10.0663C21.3385 10.4542 21.625 10.9385 21.625 11.5ZM19.2971 17.3463C19.8043 17.1434 20.2568 16.9032 20.625 16.6261V18.375C20.625 18.5729 20.5268 18.812 20.2412 19.0821C19.9545 19.3532 19.5129 19.6204 18.9257 19.8553C17.754 20.324 16.1012 20.625 14.25 20.625C12.3988 20.625 10.746 20.324 9.57434 19.8553C8.98713 19.6204 8.54549 19.3532 8.25883 19.0821C7.97322 18.812 7.875 18.5729 7.875 18.375V16.6261C8.24322 16.9032 8.69574 17.1434 9.20295 17.3463C10.5196 17.8729 12.3042 18.1875 14.25 18.1875C16.1958 18.1875 17.9804 17.8729 19.2971 17.3463Z</x:String>
    </ContentPage.Resources>

    <Border BackgroundColor="White" Stroke="#BEB1AE" Padding="10"  StrokeShape="RoundRectangle 10" Margin="48,47,49,47" WidthRequest="{OnPlatform iOS=550,Android=550,MacCatalyst=1200,WinUI=800}">        <chart:SfPyramidChart ItemsSource="{Binding GlobalWealthData}"  XBindingPath="AdultsCount" YBindingPath="WealthPercentage"
                           EnableTooltip="True" PaletteBrushes="{Binding PaletteBrushes}" Mode="Surface">

            <chart:SfPyramidChart.TooltipTemplate>
                <DataTemplate>
                    <Grid ColumnDefinitions="*" RowDefinitions="Auto,Auto,Auto">
                        <Label Grid.Row="0" HorizontalTextAlignment="Center" Text="{Binding Item.WealthPercentage, StringFormat='({0}%)'}" FontSize="13"
                               TextColor="White" FontAttributes="Bold"/>
                        <BoxView  Grid.Row="1"  HeightRequest="1" Color="Gray" Margin="1"/>
                        <HorizontalStackLayout Spacing="5" Grid.Row="2" >
                            <Rectangle HeightRequest="12" WidthRequest="12" Fill="{Binding Item.Color}"/>
                            <Label  Text="{Binding Item.AdultsCount,StringFormat='{0}M'}" FontSize="Caption" TextColor="White" />
                        </HorizontalStackLayout>
                    </Grid>
                </DataTemplate>
            </chart:SfPyramidChart.TooltipTemplate>

            <chart:SfPyramidChart.Resources>
                <converter:BrushToColorConverter x:Key="brushToColor" />
            </chart:SfPyramidChart.Resources>

            <chart:SfPyramidChart.Title>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="13"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackLayout  Grid.RowSpan="2"  Margin="0,8,0,6" Orientation="Vertical"
                     BackgroundColor="#95DB9C" />
                    <StackLayout Grid.Column="1" Margin="5,0,0,0" HorizontalOptions="Start" 
                                Orientation="Vertical" >
                        <Label  Text="The Global Wealth Pyramid" FontSize="Large" FontAttributes="Bold" 
                                  TextColor="Black"/>
                        <Label Text="An overview of global wealth distribution in 2021" FontSize="18" 
                                   TextColor="Gray"/>
                    </StackLayout>
                </Grid>
            </chart:SfPyramidChart.Title>

            <chart:SfPyramidChart.Legend>
                <chart:ChartLegend Placement="Right" >
                    <chart:ChartLegend.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="Auto,Auto" Padding="5,0,5,0" Margin="{OnPlatform Android=3.5,iOS=3.5,Default=5}">
                                <Path  Grid.Column="0" Data="{StaticResource PathData}" 
                                       Stroke="{Binding IconBrush,Converter={StaticResource brushToColor}}"  VerticalOptions="Center" HorizontalOptions="Center"/>
                                <Label Grid.Column="1" VerticalTextAlignment="Center" Text="{Binding Item.PopulationRange}" TextColor="Black"
                              FontSize="{OnPlatform Android=9,iOS=9,Default=14}" HorizontalOptions="Start" HorizontalTextAlignment="Center" Padding="5" />
                            </Grid>
                        </DataTemplate>
                    </chart:ChartLegend.ItemTemplate>
                </chart:ChartLegend>
            </chart:SfPyramidChart.Legend>

            <chart:SfPyramidChart.PlotAreaBackgroundView>
                <AbsoluteLayout>
                    <Label Text="% of world’s adults" FontSize="{OnPlatform iOS=13,Android=13,Default=Small}"  FontAttributes="Bold"  AbsoluteLayout.LayoutBounds="0.5,1,-1,-1"
			         AbsoluteLayout.LayoutFlags="PositionProportional"/>
                </AbsoluteLayout>
            </chart:SfPyramidChart.PlotAreaBackgroundView>

        </chart:SfPyramidChart>
    </Border>

</ContentPage>
